// Code generated by protoc-gen-ws. DO NOT EDIT.
//
// Source: v1/identity.proto

package v1ws

import (
	context "context"
	errors "errors"
	fmt "fmt"
	v1 "github.com/danhtran94/protoc-gen-ws/example/gen/v1"
	ws "github.com/danhtran94/protoc-gen-ws/ws"
	yamux "github.com/hashicorp/yamux"
	proto "google.golang.org/protobuf/proto"
)

const (
	// IdentityServiceName is the fully-qualified name of the IdentityService service.
	IdentityServiceName = "example.v1.IdentityService"
)

const (
	// IdentityServiceCreateUserMethod is the fully-qualified name of the IdentityService's CreateUser RPC.
	IdentityServiceCreateUserMethod = "example.v1.IdentityService/CreateUser"
	// IdentityServiceGetUserMethod is the fully-qualified name of the IdentityService's GetUser RPC.
	IdentityServiceGetUserMethod = "example.v1.IdentityService/GetUser"
	// IdentityServiceWatchUsersMethod is the fully-qualified name of the IdentityService's WatchUsers RPC.
	IdentityServiceWatchUsersMethod = "example.v1.IdentityService/WatchUsers"
	// IdentityServiceImportUsersMethod is the fully-qualified name of the IdentityService's ImportUsers RPC.
	IdentityServiceImportUsersMethod = "example.v1.IdentityService/ImportUsers"
	// IdentityServiceSyncUsersMethod is the fully-qualified name of the IdentityService's SyncUsers RPC.
	IdentityServiceSyncUsersMethod = "example.v1.IdentityService/SyncUsers"
)

// IdentityServiceWSHandler is a WebSocket handler for the example.v1.IdentityService service.
type IdentityServiceWSHandler interface {
	CreateUser(context.Context, *v1.CreateUserRequest) (*v1.CreateUserResponse, error)
	GetUser(context.Context, *v1.GetUserRequest) (*v1.GetUserResponse, error)
	WatchUsers(context.Context, *v1.WatchUsersRequest, *ws.ServerStream[*v1.UserEvent]) error
	ImportUsers(context.Context, *ws.ClientStream[*v1.CreateUserRequest]) (*v1.ImportUsersResponse, error)
	SyncUsers(context.Context, *ws.BidiStream[*v1.SyncUsersRequest, *v1.SyncUsersResponse]) error
}

// RegisterIdentityServiceWS registers the IdentityService WS handler with the router.
func RegisterIdentityServiceWS(router *ws.WSRouter, svc IdentityServiceWSHandler) {
	router.Handle("example.v1.IdentityService/CreateUser", func(ctx context.Context, payload []byte) (proto.Message, error) {
		req := new(v1.CreateUserRequest)
		if err := proto.Unmarshal(payload, req); err != nil {
			return nil, err
		}
		return svc.CreateUser(ctx, req)
	})
	router.Handle("example.v1.IdentityService/GetUser", func(ctx context.Context, payload []byte) (proto.Message, error) {
		req := new(v1.GetUserRequest)
		if err := proto.Unmarshal(payload, req); err != nil {
			return nil, err
		}
		return svc.GetUser(ctx, req)
	})
	router.HandleStream("example.v1.IdentityService/WatchUsers", func(ctx context.Context, stream *ws.Stream) {
		data, err := stream.Recv()
		if err != nil {
			stream.SendError(err.Error())
			return
		}
		req := new(v1.WatchUsersRequest)
		if err := proto.Unmarshal(data, req); err != nil {
			stream.SendError(err.Error())
			return
		}
		ss := ws.NewServerStream[*v1.UserEvent](stream)
		if err := svc.WatchUsers(ctx, req, ss); err != nil {
			stream.SendError(err.Error())
		}
	})
	router.HandleStream("example.v1.IdentityService/ImportUsers", func(ctx context.Context, stream *ws.Stream) {
		cs := ws.NewClientStream[*v1.CreateUserRequest](stream, func() *v1.CreateUserRequest { return new(v1.CreateUserRequest) })
		resp, err := svc.ImportUsers(ctx, cs)
		if err != nil {
			stream.SendError(err.Error())
			return
		}
		stream.SendProto(resp)
	})
	router.HandleStream("example.v1.IdentityService/SyncUsers", func(ctx context.Context, stream *ws.Stream) {
		bs := ws.NewBidiStream[*v1.SyncUsersRequest, *v1.SyncUsersResponse](stream, func() *v1.SyncUsersRequest { return new(v1.SyncUsersRequest) })
		if err := svc.SyncUsers(ctx, bs); err != nil {
			stream.SendError(err.Error())
		}
	})
}

// UnimplementedIdentityServiceWSHandler returns errors from all methods.
type UnimplementedIdentityServiceWSHandler struct{}

func (UnimplementedIdentityServiceWSHandler) CreateUser(_ context.Context, _ *v1.CreateUserRequest) (*v1.CreateUserResponse, error) {
	return nil, errors.New("example.v1.IdentityService.CreateUser is not implemented")
}

func (UnimplementedIdentityServiceWSHandler) GetUser(_ context.Context, _ *v1.GetUserRequest) (*v1.GetUserResponse, error) {
	return nil, errors.New("example.v1.IdentityService.GetUser is not implemented")
}

func (UnimplementedIdentityServiceWSHandler) WatchUsers(_ context.Context, _ *v1.WatchUsersRequest, _ *ws.ServerStream[*v1.UserEvent]) error {
	return errors.New("example.v1.IdentityService.WatchUsers is not implemented")
}

func (UnimplementedIdentityServiceWSHandler) ImportUsers(_ context.Context, _ *ws.ClientStream[*v1.CreateUserRequest]) (*v1.ImportUsersResponse, error) {
	return nil, errors.New("example.v1.IdentityService.ImportUsers is not implemented")
}

func (UnimplementedIdentityServiceWSHandler) SyncUsers(_ context.Context, _ *ws.BidiStream[*v1.SyncUsersRequest, *v1.SyncUsersResponse]) error {
	return errors.New("example.v1.IdentityService.SyncUsers is not implemented")
}

// IdentityServiceWSClient is a WebSocket client for the example.v1.IdentityService service.
type IdentityServiceWSClient interface {
	CreateUser(context.Context, *v1.CreateUserRequest) (*v1.CreateUserResponse, error)
	GetUser(context.Context, *v1.GetUserRequest) (*v1.GetUserResponse, error)
	WatchUsers(context.Context, *v1.WatchUsersRequest) (*ws.ServerStreamClient[*v1.UserEvent], error)
	ImportUsers(context.Context) (*ws.ClientStreamClient[*v1.CreateUserRequest, *v1.ImportUsersResponse], error)
	SyncUsers(context.Context) (*ws.BidiStreamClient[*v1.SyncUsersRequest, *v1.SyncUsersResponse], error)
}

// NewIdentityServiceWSClient constructs a WebSocket client for the example.v1.IdentityService service.
func NewIdentityServiceWSClient(session *yamux.Session) IdentityServiceWSClient {
	return &identityServiceWSClient{session: session}
}

type identityServiceWSClient struct {
	session *yamux.Session
}

func (c *identityServiceWSClient) CreateUser(ctx context.Context, req *v1.CreateUserRequest) (*v1.CreateUserResponse, error) {
	data, err := ws.CallUnary(c.session, "example.v1.IdentityService/CreateUser", req)
	if err != nil {
		return nil, err
	}
	resp := new(v1.CreateUserResponse)
	if err := proto.Unmarshal(data, resp); err != nil {
		return nil, fmt.Errorf("unmarshal response: %w", err)
	}
	return resp, nil
}

func (c *identityServiceWSClient) GetUser(ctx context.Context, req *v1.GetUserRequest) (*v1.GetUserResponse, error) {
	data, err := ws.CallUnary(c.session, "example.v1.IdentityService/GetUser", req)
	if err != nil {
		return nil, err
	}
	resp := new(v1.GetUserResponse)
	if err := proto.Unmarshal(data, resp); err != nil {
		return nil, fmt.Errorf("unmarshal response: %w", err)
	}
	return resp, nil
}

func (c *identityServiceWSClient) WatchUsers(ctx context.Context, req *v1.WatchUsersRequest) (*ws.ServerStreamClient[*v1.UserEvent], error) {
	stream, err := ws.OpenStream(ctx, c.session, "example.v1.IdentityService/WatchUsers")
	if err != nil {
		return nil, err
	}
	if err := stream.SendProto(req); err != nil {
		stream.Close()
		return nil, err
	}
	return ws.NewServerStreamClient[*v1.UserEvent](stream, func() *v1.UserEvent { return new(v1.UserEvent) }), nil
}

func (c *identityServiceWSClient) ImportUsers(ctx context.Context) (*ws.ClientStreamClient[*v1.CreateUserRequest, *v1.ImportUsersResponse], error) {
	stream, err := ws.OpenStream(ctx, c.session, "example.v1.IdentityService/ImportUsers")
	if err != nil {
		return nil, err
	}
	return ws.NewClientStreamClient[*v1.CreateUserRequest, *v1.ImportUsersResponse](stream, func() *v1.ImportUsersResponse { return new(v1.ImportUsersResponse) }), nil
}

func (c *identityServiceWSClient) SyncUsers(ctx context.Context) (*ws.BidiStreamClient[*v1.SyncUsersRequest, *v1.SyncUsersResponse], error) {
	stream, err := ws.OpenStream(ctx, c.session, "example.v1.IdentityService/SyncUsers")
	if err != nil {
		return nil, err
	}
	return ws.NewBidiStreamClient[*v1.SyncUsersRequest, *v1.SyncUsersResponse](stream, func() *v1.SyncUsersResponse { return new(v1.SyncUsersResponse) }), nil
}
